<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boda Abril & Rodrigo</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: #FFFEF7;
      color: #2C2C2C;
      text-align: center;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    header {
      padding: 40px 20px 30px;
    }
    
    .couple-img {
      width: 100%;
      max-width: 350px;
      height: 400px;
      margin: 0 auto 25px;
      border-radius: 10px;
      overflow: hidden;
      border: 2px solid #9AB973;
      background: #f8f8f8 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%239AB973"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>') no-repeat center;
      background-size: 80px 80px;
    }
    
    .couple-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    h1 {
      font-size: 3.5rem;
      margin-bottom: 10px;
      font-family: 'Parisienne', cursive;
      color: #6B8E23;
    }
    
    h2 {
      font-size: 1.8rem;
      font-weight: 300;
      margin-bottom: 20px;
    }
    
    section {
      padding: 60px 20px;
    }
    
    .section-title {
      font-family: 'Parisienne', cursive;
      color: #6B8E23;
      font-size: 2.5rem;
      margin-bottom: 30px;
    }
    
    .contador {
      font-size: 1.8rem;
      margin: 40px 0 20px;
      color: #6B8E23;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .countdown-unit {
      display: flex;
      flex-direction: column;
      min-width: 70px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      border: 1px solid #9AB973;
    }
    
    .countdown-value {
      font-size: 2rem;
      font-weight: bold;
      color: #556B2F;
    }
    
    .countdown-label {
      font-size: 0.8rem;
      color: #2C2C2C;
      text-transform: uppercase;
    }
    
    /* Sección de Familias */
    .families-section {
      background: linear-gradient(135deg, #f8f9fa 0%, #FFFEF7 100%);
    }
    
    .families-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
      margin-top: 30px;
    }
    
    .family-card {
      flex: 1;
      min-width: 280px;
      max-width: 400px;
      padding: 25px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
      border: 1px solid #9AB973;
    }
    
    .family-title {
      font-family: 'Parisienne', cursive;
      color: #6B8E23;
      font-size: 1.8rem;
      margin-bottom: 20px;
    }
    
    .family-list {
      list-style: none;
      text-align: center;
    }
    
    .family-list li {
      padding: 10px 0;
      font-size: 1.1rem;
      color: #2C2C2C;
      position: relative;
    }
    
    /* Sección de Padrinos */
    .godparents-section {
      background: linear-gradient(135deg, #FFFEF7 0%, #f8f9fa 100%);
    }
    
    .godparents-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
      margin-top: 30px;
    }
    
    .godparent-card {
      flex: 1;
      min-width: 280px;
      max-width: 400px;
      padding: 25px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
      border: 2px solid #6B8E23;
      position: relative;
    }
    
    .godparent-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(to right, #556B2F, #6B8E23);
    }
    
    .godparent-title {
      font-family: 'Parisienne', cursive;
      color: #6B8E23;
      font-size: 1.8rem;
      margin-bottom: 20px;
    }
    
    .godparent-icon {
      font-size: 2.5rem;
      color: #6B8E23;
      margin-bottom: 15px;
    }
    
    /* Sección de Eventos */
    .events-section {
      background: linear-gradient(135deg, #f8f9fa 0%, #FFFEF7 100%);
    }
    
    .events-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
      margin-top: 30px;
    }
    
    .event-card {
      flex: 1;
      min-width: 280px;
      max-width: 450px;
      padding: 30px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
      border: 1px solid #9AB973;
      position: relative;
    }
    
    .event-icon {
      font-size: 2.8rem;
      color: #6B8E23;
      margin-bottom: 20px;
    }
    
    .event-title {
      font-family: 'Parisienne', cursive;
      color: #6B8E23;
      font-size: 2rem;
      margin-bottom: 15px;
    }
    
    .event-details {
      text-align: left;
      margin-bottom: 20px;
    }
    
    .event-details p {
      margin: 8px 0;
      display: flex;
      align-items: flex-start;
    }
    
    .event-details i {
      color: #6B8E23;
      margin-right: 10px;
      margin-top: 3px;
      min-width: 20px;
    }
    
    .event-button {
      display: inline-block;
      background: #6B8E23;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .event-button:hover {
      background: #556B2F;
      transform: translateY(-2px);
    }
    
    /* Sección de Código de Vestimenta */
    .dress-code-section {
      background: linear-gradient(135deg, #FFFEF7 0%, #f8f9fa 100%);
      position: relative;
      overflow: hidden;
    }
    
    .dress-code-section::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%236B8E23" opacity="0.05" d="M30,30 Q50,20 70,30 T100,40 L100,100 L0,100 L0,40 Q15,30 30,30"/></svg>');
      background-size: 200px 200px;
    }
    
    .dress-code-card {
      max-width: 500px;
      margin: 0 auto;
      padding: 30px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      border: 2px solid #2C2C2C;
      position: relative;
      z-index: 2;
    }
    
    .dress-code-icon {
      font-size: 3.5rem;
      color: #2C2C2C;
      margin-bottom: 20px;
    }
    
    .dress-code-title {
      font-family: 'Parisienne', cursive;
      font-size: 2.2rem;
      color: #2C2C2C;
      margin-bottom: 15px;
    }
    
    .dress-code-description {
      font-size: 1.2rem;
      color: #2C2C2C;
      margin-bottom: 20px;
      font-weight: 500;
    }
    
    .dress-code-note {
      font-size: 1rem;
      color: #6B8E23;
      font-style: italic;
      margin-top: 15px;
    }
    
    .black-accent {
      display: inline-block;
      width: 60px;
      height: 3px;
      background: #2C2C2C;
      margin: 10px 0;
    }
    
    /* Formulario RSVP */
    .rsvp-form {
      max-width: 500px;
      margin: 0 auto;
      padding: 25px;
      background: white;
      border-radius: 10px;
      border: 1px solid #9AB973;
    }
    
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 14px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: inherit;
      font-size: 16px;
      -webkit-appearance: none;
      appearance: none;
    }
    
    .companions-container {
      display: none;
      margin-top: 15px;
      padding: 15px;
      background-color: #FFFDF0;
      border-radius: 6px;
      border: 1px dashed #6B8E23;
    }
    
    .companion-input {
      margin-bottom: 12px;
    }
    
    button {
      background: #6B8E23;
      color: white;
      border: none;
      padding: 16px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
    }
    
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    .spinner {
      border: 3px solid rgba(107, 142, 35, 0.3);
      border-radius: 50%;
      border-top: 3px solid #6B8E23;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .success-message {
      display: none;
      background: white;
      padding: 25px;
      border-radius: 10px;
      border: 2px solid #6B8E23;
      max-width: 500px;
      margin: 0 auto;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .family-card, .godparent-card, .event-card, .dress-code-card {
        padding: 20px;
      }
      
      .event-icon, .dress-code-icon {
        font-size: 2.5rem;
      }
      
      .event-title, .dress-code-title {
        font-size: 1.8rem;
      }
      
      .families-container, .godparents-container, .events-container {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="container">
      <div class="couple-img">
        <!-- Imagen optimizada para iOS -->
        <img src="https://i.imgur.com/5t8Mea6.png" alt="Abril y Rodrigo" 
             onerror="this.style.display='none'" 
             style="display: block; width: 100%; height: 100%; object-fit: cover;">
      </div>
      <h1>Abril & Rodrigo</h1>
      <h2>29 de Noviembre 2025</h2>
    </div>
  </header>

  <section>
    <div class="container">
      <h2 class="section-title">Nuestra Boda</h2>
      
      <!-- Contador simplificado y compatible con iOS -->
      <div class="contador" id="contador">
        <div class="countdown-unit">
          <span class="countdown-value" id="days">00</span>
          <span class="countdown-label">Días</span>
        </div>
        <div class="countdown-unit">
          <span class="countdown-value" id="hours">00</span>
          <span class="countdown-label">Horas</span>
        </div>
        <div class="countdown-unit">
          <span class="countdown-value" id="minutes">00</span>
          <span class="countdown-label">Minutos</span>
        </div>
        <div class="countdown-unit">
          <span class="countdown-value" id="seconds">00</span>
          <span class="countdown-label">Segundos</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Sección de Familias -->
  <section class="families-section">
    <div class="container">
      <h2 class="section-title">Nuestras Familias</h2>
      <p style="margin-bottom: 20px;">Con la bendición de nuestros padres</p>
      
      <div class="families-container">
        <div class="family-card">
          <h3 class="family-title">Padres de la Novia</h3>
          <ul class="family-list">
            <li>José Rosario Contreras Delgadillo</li>
            <li>Rosalia Córdova Riebeling</li>
          </ul>
        </div>
        
        <div class="family-card">
          <h3 class="family-title">Padres del Novio</h3>
          <ul class="family-list">
            <li>Mario Figueroa Hernández</li>
            <li>Luz Arcelia Flores Galván</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Sección de Padrinos -->
  <section class="godparents-section">
    <div class="container">
      <h2 class="section-title">Nuestros Padrinos</h2>
      <p style="margin-bottom: 20px;">Agradecemos su apoyo y guía</p>
      
      <div class="godparents-container">
        <div class="godparent-card">
          <div class="godparent-icon">
            <i class="fas fa-hands-praying"></i>
          </div>
          <h3 class="godparent-title">Padrinos de Velación</h3>
          <ul class="family-list">
            <li>Miguel Ángel Llamas Chavez</li>
            <li>Marisela Madera Vargas</li>
          </ul>
        </div>
        
        <div class="godparent-card">
          <div class="godparent-icon">
            <i class="fas fa-award"></i>
          </div>
          <h3 class="godparent-title">Padrinos de Honor</h3>
          <ul class="family-list">
            <li>Héctor Iván Gonzales Castillo</li>
            <li>Esteffany Michelle Llamas Madera</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Sección de Eventos -->
  <section class="events-section">
    <div class="container">
      <h2 class="section-title">Nuestra Celebración</h2>
      <p style="margin-bottom: 20px;">Los detalles de nuestro día especial</p>
      
      <div class="events-container">
        <div class="event-card">
          <div class="event-icon">
            <i class="fas fa-church"></i>
          </div>
          <h3 class="event-title">Ceremonia</h3>
          <div class="event-details">
            <p><i class="fas fa-map-marker-alt"></i> Templo Parroquia de la Santa Cruz</p>
            <p><i class="fas fa-location-dot"></i> Calle Revolución Norte, #61, Potrero Nuevo</p>
            <p><i class="fas fa-calendar"></i> 29 de Noviembre 2025</p>
            <p><i class="fas fa-clock"></i> 13:00 hrs</p>
          </div>
          <a href="https://maps.app.goo.gl/hm3z2WTVFDwujGSh8" target="_blank" class="event-button">
            <i class="fas fa-map"></i> Ver ubicación
          </a>
        </div>
        
        <div class="event-card">
          <div class="event-icon">
            <i class="fas fa-glass-cheers"></i>
          </div>
          <h3 class="event-title">Recepción</h3>
          <div class="event-details">
            <p><i class="fas fa-map-marker-alt"></i> Terraza D' Ángel</p>
            <p><i class="fas fa-location-dot"></i> Calle La Playa, Juanacatlán</p>
            <p><i class="fas fa-calendar"></i> 29 de Noviembre 2025</p>
            <p><i class="fas fa-clock"></i> 15:00 hrs</p>
          </div>
          <a href="https://maps.app.goo.gl/A5BQUF2xE21MCRiH6" target="_blank" class="event-button">
            <i class="fas fa-map"></i> Ver ubicación
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Sección de Código de Vestimenta -->
  <section class="dress-code-section">
    <div class="container">
      <h2 class="section-title">Código de Vestimenta</h2>
      <p style="margin-bottom: 30px; font-size: 1.1rem;">Queremos que formes parte de nuestra celebración con elegancia y estilo</p>
      
      <div class="dress-code-card">
        <div class="dress-code-icon">
          <i class="fas fa-tshirt"></i>
        </div>
        <h3 class="dress-code-title">Elegancia en Negro</h3>
        <div class="black-accent"></div>
        <p class="dress-code-description">
          <strong>Formal</strong><br>
          Preferimos el color negro para crear una atmósfera sofisticada y elegante
        </p>
        <div style="display: flex; justify-content: center; gap: 20px; margin: 25px 0; flex-wrap: wrap;">
          <div style="text-align: center;">
            <i class="fas fa-user-tie" style="font-size: 2rem; color: #2C2C2C; margin-bottom: 8px;"></i>
            <p style="font-size: 0.9rem;">Traje formal<br>negro o oscuro</p>
          </div>
          <div style="text-align: center;">
            <i class="fas fa-female" style="font-size: 2rem; color: #2C2C2C; margin-bottom: 8px;"></i>
            <p style="font-size: 0.9rem;">Vestido o<br>conjunto elegante</p>
          </div>
        </div>
        <p class="dress-code-note">
          <i class="fas fa-heart" style="color: #6B8E23;"></i> 
          Tu presencia es lo más importante, pero agradecemos seguir el código de vestimenta
        </p>
      </div>
    </div>
  </section>

  <!-- Sección de RSVP -->
  <section>
    <div class="container">
      <h2 class="section-title">Confirma tu asistencia</h2>
      
      <div class="loading" id="loadingIndicator">
        <div class="spinner"></div>
        <p>Procesando confirmación...</p>
      </div>
      
      <div class="rsvp-form" id="rsvpForm">
        <div class="form-group">
          <label for="nombre">Nombre completo *</label>
          <input type="text" id="nombre" name="nombre" required placeholder="Tu nombre completo">
        </div>
        
        <div class="form-group">
          <label for="email">Correo electrónico *</label>
          <input type="email" id="email" name="email" required placeholder="tu@email.com">
        </div>
        
        <div class="form-group">
          <label for="asistentes">Número de asistentes *</label>
          <select id="asistentes" name="asistentes" required>
            <option value="">Selecciona...</option>
            <option value="1">1 persona (solo yo)</option>
            <option value="2">2 personas</option>
            <option value="3">3 personas</option>
            <option value="4">4 personas</option>
            <option value="5">5 personas</option>
          </select>
        </div>
        
        <div id="companionsContainer" class="companions-container">
          <p style="color: #6B8E23; margin-bottom: 15px; font-weight: bold;">
            Nombres de los acompañantes:
          </p>
          <div id="companionsInputs"></div>
        </div>
        
        <div class="form-group">
          <label for="mensaje">Mensaje para los novios (opcional)</label>
          <textarea id="mensaje" name="mensaje" placeholder="Escribe un mensaje especial..."></textarea>
        </div>
        
        <button type="button" id="submitBtn" onclick="handleFormSubmit()">Confirmar asistencia</button>
      </div>
      
      <div class="success-message" id="successMessage">
        <i class="fas fa-check-circle" style="font-size: 3rem; color: #6B8E23; margin-bottom: 15px;"></i>
        <h3 style="color: #6B8E23; margin-bottom: 15px; font-family: 'Parisienne', cursive; font-size: 2rem;">
          ¡Confirmación Exitosa!
        </h3>
        <p>Gracias por confirmar tu asistencia.</p>
        <p>¡Estamos emocionados de celebrar contigo!</p>
      </div>
    </div>
  </section>

  <footer style="background: #1A1A1A; color: #9AB973; padding: 30px 20px; margin-top: 40px;">
    <p style="font-family: 'Parisienne', cursive; font-size: 1.5rem;">Con amor, Abril & Rodrigo</p>
  </footer>

  <script>
    // SOLUCIÓN ESPECÍFICA PARA PROBLEMAS EN iOS
    
    // CONFIGURACIÓN
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby0-agjcQrYSElog9SLrAvXNLKOVqoH3l8Of7rOfpSkD8gVrTwtCRA9lvZeyn1FYTR5/exec';

    // DETECCIÓN DE iOS
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

    console.log('Dispositivo iOS:', isIOS);

    // INICIALIZACIÓN
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Iniciando aplicación para iOS');
      initApp();
    });

    function initApp() {
      // Iniciar temporizador de forma segura
      startCountdown();
      
      // Configurar formulario
      setupForm();
      
      // Precargar imagen
      preloadImage();
    }

    // TEMPORIZADOR COMPATIBLE CON iOS
    function startCountdown() {
      console.log('Iniciando cuenta regresiva...');
      
      // Fecha objetivo - formato compatible con iOS
      const targetDate = Date.UTC(2025, 10, 29, 19, 0, 0);
      
      function updateTimer() {
        const now = new Date().getTime();
        const diff = targetDate - now;
        
        if (diff <= 0) {
          document.getElementById('contador').innerHTML = '<h3>¡Hoy es el gran día!</h3>';
          return;
        }
        
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        // Actualizar elementos de forma segura
        updateElement('days', days);
        updateElement('hours', hours);
        updateElement('minutes', minutes);
        updateElement('seconds', seconds);
      }
      
      // Ejecutar inmediatamente y luego cada segundo
      updateTimer();
      setInterval(updateTimer, 1000);
    }

    function updateElement(id, value) {
      const element = document.getElementById(id);
      if (element) {
        element.textContent = String(value).padStart(2, '0');
      }
    }

    // PRECARGAR IMAGEN
    function preloadImage() {
      const img = new Image();
      img.src = 'https://i.imgur.com/5t8Mea6.png';
      img.onload = function() {
        console.log('Imagen cargada correctamente');
      };
      img.onerror = function() {
        console.log('Error cargando imagen, mostrando fallback');
      };
    }

    // CONFIGURACIÓN DEL FORMULARIO
    function setupForm() {
      const asistentesSelect = document.getElementById('asistentes');
      asistentesSelect.addEventListener('change', handleAsistentesChange);
    }

    // MANEJAR CAMBIO EN ASISTENTES
    function handleAsistentesChange() {
      const select = document.getElementById('asistentes');
      const container = document.getElementById('companionsContainer');
      const inputsContainer = document.getElementById('companionsInputs');
      
      const numAsistentes = parseInt(select.value);
      
      if (numAsistentes > 1) {
        container.style.display = 'block';
        inputsContainer.innerHTML = '';
        
        for (let i = 1; i < numAsistentes; i++) {
          const inputGroup = document.createElement('div');
          inputGroup.className = 'companion-input';
          inputGroup.innerHTML = `
            <label>Acompañante ${i}:</label>
            <input type="text" id="acompanante${i}" placeholder="Nombre completo" required
                   style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
          `;
          inputsContainer.appendChild(inputGroup);
        }
      } else {
        container.style.display = 'none';
        inputsContainer.innerHTML = '';
      }
    }

    // MANEJAR ENVÍO DEL FORMULARIO
    async function handleFormSubmit() {
      const nombre = document.getElementById('nombre').value.trim();
      const email = document.getElementById('email').value.trim();
      const asistentes = document.getElementById('asistentes').value;
      const mensaje = document.getElementById('mensaje').value.trim();
      
      if (!nombre || !email || !asistentes) {
        alert('Por favor completa todos los campos obligatorios');
        return;
      }
      
      if (!isValidEmail(email)) {
        alert('Por favor ingresa un correo electrónico válido');
        return;
      }
      
      const numAsistentes = parseInt(asistentes);
      const acompanantes = [];
      
      if (numAsistentes > 1) {
        for (let i = 1; i < numAsistentes; i++) {
          const input = document.getElementById(`acompanante${i}`);
          if (input) {
            const nombreAcompanante = input.value.trim();
            if (!nombreAcompanante) {
              alert(`Por favor ingresa el nombre del acompañante ${i}`);
              return;
            }
            acompanantes.push(nombreAcompanante);
          }
        }
      }
      
      showLoadingState();
      
      const formData = {
        nombre: nombre,
        email: email,
        asistentes: asistentes,
        acompanantes: acompanantes.join(', '),
        mensaje: mensaje || 'Sin mensaje',
        fecha: new Date().toLocaleString('es-MX'),
        timestamp: new Date().getTime(),
        source: 'wedding_website'
      };
      
      try {
        await sendToGoogleSheets(formData);
        showSuccessState();
      } catch (error) {
        console.error('Error:', error);
        const localSuccess = saveToLocalStorage(formData);
        
        if (localSuccess) {
          showSuccessState();
        } else {
          alert('Error al enviar la confirmación. Por favor intenta nuevamente.');
          hideLoadingState();
        }
      }
    }

    // ENVIAR A GOOGLE SHEETS
    async function sendToGoogleSheets(data) {
      try {
        const formData = new FormData();
        Object.keys(data).forEach(key => {
          formData.append(key, data[key]);
        });
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: formData,
          mode: 'no-cors'
        });
        
        return { result: 'success' };
        
      } catch (error) {
        throw error;
      }
    }

    // GUARDAR EN LOCAL STORAGE
    function saveToLocalStorage(data) {
      try {
        const existing = localStorage.getItem('wedding_confirmations');
        const confirmations = existing ? JSON.parse(existing) : [];
        
        confirmations.push({
          ...data,
          localSave: true,
          localTimestamp: new Date().toISOString()
        });
        
        localStorage.setItem('wedding_confirmations', JSON.stringify(confirmations));
        return true;
      } catch (error) {
        console.error('Error guardando en localStorage:', error);
        return false;
      }
    }

    // FUNCIONES DE UI
    function showLoadingState() {
      document.getElementById('loadingIndicator').style.display = 'block';
      document.getElementById('rsvpForm').style.display = 'none';
      document.getElementById('submitBtn').disabled = true;
    }

    function hideLoadingState() {
      document.getElementById('loadingIndicator').style.display = 'none';
      document.getElementById('rsvpForm').style.display = 'block';
      document.getElementById('submitBtn').disabled = false;
    }

    function showSuccessState() {
      document.getElementById('loadingIndicator').style.display = 'none';
      document.getElementById('successMessage').style.display = 'block';
      
      setTimeout(() => {
        resetForm();
        document.getElementById('successMessage').style.display = 'none';
      }, 4000);
    }

    function resetForm() {
      document.getElementById('rsvpForm').reset();
      document.getElementById('companionsContainer').style.display = 'none';
      document.getElementById('companionsInputs').innerHTML = '';
      document.getElementById('submitBtn').disabled = false;
      document.getElementById('rsvpForm').style.display = 'block';
    }

    // VALIDACIÓN DE EMAIL
    function isValidEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }
  </script>
</body>
</html>